---
title: "Attach NASA POWER weather with weatherjoin"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Attach NASA POWER weather with weatherjoin}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

## Overview

`weatherjoin::join_weather()` attaches NASA POWER weather variables to an event table with
robust time handling, efficient call planning, and local caching.

## Minimal example

```{r, eval=FALSE}
library(data.table)
library(weatherjoin)

X <- data.table(
  event_time = as.POSIXct(c("2024-04-07 12:30:00","2024-04-07 13:30:00"), tz="UTC"),
  LAT = c(51.5, 51.5),
  LON = c(-0.1, -0.1)
)

out <- join_weather(
  X,
  params = c("T2M"),
  time = "event_time",
  lat_col = "LAT",
  lon_col = "LON",
  time_api = "hourly",
  roll = "nearest",
  roll_max_hours = 1
)
```

## Time input

`time` can be a single column name (POSIXct / Date / character / numeric), or a vector
of column names to assemble timestamps (e.g. `c("YEAR","MO","DY","HR")`).

`time_api` controls daily vs hourly data:
- `"guess"` uses the presence of time-of-day in the input timestamps
- `"daily"` is allowed even if input is hourly (downsample)
- `"hourly"` errors if the input has no time-of-day information

## Spatial planning

Use `spatial_mode="by_group"` with `group_col` to make one POWER call per group.

## Cache

By default, cache is created on first use (not install). Use:

```r
wj_cache_list()
wj_cache_clear(dry_run=TRUE)
```
