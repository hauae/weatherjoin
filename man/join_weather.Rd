% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/join_weather.R
\name{join_weather}
\alias{join_weather}
\title{Join gridded weather data to an event table}
\usage{
join_weather(
  x,
  params,
  time,
  lat_col = "lat",
  lon_col = "lon",
  time_api = c("guess", "hourly", "daily"),
  tz = "UTC",
  roll = c("nearest", "last", "none"),
  roll_max_hours = NULL,
  spatial_mode = c("exact", "by_group", "cluster"),
  group_col = NULL,
  cluster_radius_m = NULL,
  cache_scope = c("user", "project"),
  cache_dir = NULL,
  community = "ag",
  site_elevation = c("auto", "constant"),
  elev_constant = 100,
  elev_fun = NULL,
  verbose = FALSE,
  ...
)
}
\arguments{
\item{x}{A data.frame/data.table with event rows.}

\item{params}{Character vector of NASA POWER parameter codes (e.g. \code{"T2M"}).}

\item{time}{A single column name containing time (POSIXct/Date/character/numeric) OR
a character vector of column names used to assemble a timestamp
(e.g. \code{c("YEAR","MO","DY","HR")}).}

\item{lat_col, lon_col}{Column names for latitude and longitude.}

\item{time_api}{One of \code{"guess"}, \code{"hourly"}, \code{"daily"}.
If \code{"daily"} is chosen while input is hourly, timestamps are downsampled to dates.
If \code{"hourly"} is chosen while input has no time-of-day, an error is raised.}

\item{tz}{Time zone used to interpret/construct input timestamps (default \code{"UTC"}).
Input times are standardised internally to UTC.}

\item{roll}{Join behavior when matching hourly timestamps: \code{"nearest"} (default),
\code{"last"}, or \code{"none"} (exact).}

\item{roll_max_hours}{Optional maximum allowed distance (in hours) for a rolling match;
farther matches become NA.}

\item{spatial_mode}{How to reduce many points to representative locations before calling the provider:
\code{"exact"}, \code{"by_group"}, or \code{"cluster"}.}

\item{group_col}{Grouping column used when \code{spatial_mode="by_group"}.}

\item{cluster_radius_m}{Clustering radius in meters when \code{spatial_mode="cluster"}.}

\item{cache_scope}{Where to store cache by default: \code{"user"} or \code{"project"}.}

\item{cache_dir}{Optional explicit cache directory. If NULL, determined by \code{cache_scope}.}

\item{community}{Passed to \code{nasapower::get_power()} (e.g. \code{"ag"}).}

\item{site_elevation}{Elevation strategy: \code{"auto"} or \code{"constant"} (or a numeric scalar/vector).}

\item{elev_constant}{Constant elevation (meters) when \code{site_elevation="constant"} or default for \code{"auto"}.}

\item{elev_fun}{Optional function \code{function(lon, lat, ...)} returning elevation (meters)
for representative points.}

\item{verbose}{If TRUE, print progress messages.}

\item{...}{Passed through to \code{nasapower::get_power()}.}
}
\value{
A data.table with requested weather columns appended.
}
\description{
Attach gridded weather variables to rows of an event table using spatial planning,
local caching, and exact/rolling joins.
}
\details{
The current provider is NASA POWER, accessed via the \pkg{nasapower} package.
The package requests POWER data in UTC and performs all internal planning and matching in UTC.

Advanced behaviour is controlled via package options; see \code{\link{weatherjoin_options}}.
In particular:
\itemize{
\item Cache policy (staleness and reuse rules).
\item Time-window planning and splitting for sparse time series.
\item Daily \dQuote{dummy hour} used when constructing timestamps for daily data.
\item Optional diagnostic columns in outputs.
}
}
